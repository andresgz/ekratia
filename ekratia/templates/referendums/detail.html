{% extends "base.html" %}
{% load bootstrap3 i18n humanize %}
{% block title %}{% trans "Referendum" %}: {{ object.title }}{% endblock title %}
{% block content %}
<div class="container threads">
    <div class="referendum" ng-controller="ReferendumController">
        <span us-spinner="{radius:30, width:8, length: 16}"></span>
        <h1>{{ object.title }}</h1>
        <div class="referendums-head">
            <div class="referendum-rule-title top20">{% trans "Text that this referendum will remove from our rules" %}:</div>
            <p ng-bind-html="'{{object.text_remove_rules }}' | nl2p"></p>
            <div  class="referendum-rule-title top20">{% trans "Text that this referendum will add to our rules" %}:</div>
            <p ng-bind-html="'{{object.text_add_rules }}' | nl2p"></p>
        </div>
        {% if request.user.is_authenticated and request.user == object.user and not object.is_open and not object.open_time %}
        <div class="referendum-vote text-center top20">
            <button class="btn btn-primary btn-md" data-ng-init="referendumInit({{ object.id }}, '{% url 'referendums:open' object.slug %}')" ng-click="openVoting()" >{% trans "Open for Voting" %}</button>
        </div>
        {% endif %}
        {% if object.is_open %}
        <div class="horizontal-line top20"></div>
        <div class="referendum-vote text-center top20">
        <h2>{% trans "Vote for this Referendum" %}</h2>
            {% if user_vote.value %}
                <a class="btn btn-primary btn-lg top20" href="{% url 'referendums:vote' object.slug %}" >
                    {% trans "Change Vote" %}
                </a>
                <div class="top20">{% trans "You voted" %} 
                {% if user_vote.value > 0 %}
                    <strong>"{% trans "Yes" %}"</strong>
                {% else %}
                    <strong>"{% trans "No" %}"</strong>
                {% endif %} {{ user_vote.date | naturaltime }}
                </div>
            {% else %}
                <a class="btn btn-primary btn-lg top20" href="{% url 'referendums:vote' object.slug %}" >
                    {% trans "Vote Now" %}
                </a>
            {% endif %}
            <div>{% trans "Expires in" %} <strong>{{ object.end_time | naturaltime }}</strong></div>
        </div>
        {% endif %}
        {% if object.is_finished %}
            <div class="alert alert-warning alert-dismissible text-center top20" role="alert">
              {% trans "This Referendum has ended" %}
            </div>
        {% endif %}
    </div>
    <div class="row top20" ng-controller="CommentsController" data-ng-init="initThread('referendum', {{object.id}}, {{ object.comment_id}})">
        <div class="col-xs-12">
            <ul class="root-comment-list">
                <li class="first-level" ng-repeat="comment in comments" ng-include="'tree_item_renderer.html'" on-last-repeat>
                </li>
            </ul>
        </div>
    </div>
</div>
<script type="text/ng-template"  id="tree_item_renderer.html">
{% include "threads/_comment_node.html" %}
</script>



{% endblock content %}
